<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Loop - Rohith Kizhakekkara</title>
    <script>
      (function() {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <a href="../index.html" class="site-title">Rohith Kizhakekkara</a>
        <span class="site-subtitle">
          M.S. Software Engineering at UMD
          <span title="Fear the Turtle">üê¢</span> (Go Terps!)
        </span>

        <nav style="display: flex; align-items: center">
          <a href="../index.html">About</a>
          <a href="../blog.html">Blog</a>
          <a href="mailto:rohithk@umd.edu">Contact</a>
          <button
            id="theme-toggle"
            aria-label="Toggle Dark Mode"
            style="
              background: none;
              border: none;
              cursor: pointer;
              padding: 0;
              margin-left: 10px;
              color: var(--text-primary);
              display: flex;
              align-items: center;
            "
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-moon"
            >
              <path
                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
              ></path>
            </svg>
          </button>
        </nav>
      </header>

      <main>
        <article class="blog-post">
          <h1>Event Loop</h1>
          <div class="post-meta">
            <span class="date">June 2025</span> |
            <span class="category">JavaScript</span>
          </div>

          <hr />

          <p>The Call Stack does not wait for anyone; it executes everything in one go. Hence, if we want JavaScript (JS) to wait for something, it cannot do that on its own. To do more than this, JS needs help from the browser, and for this, the browser provides Web APIs.</p>

          <h2>Web APIs</h2>
          <p>All of these are not part of JavaScript; they are part of the Web APIs provided by the browser environment:</p>
          <ul>
            <li>setTimeout</li>
            <li>DOM APIs</li>
            <li>fetch()</li>
            <li>Local Storage</li>
            <li>Console</li>
            <li>Location</li>
          </ul>
          <p>All of these are available inside the global object (window). Because the window object is global, we can use these functionalities without using the window. prefix.</p>
          <ul>
            <li>Example: window.setTimeout() can just be written as setTimeout().</li>
          </ul>

          <h2>Event Loop & Callback Queue</h2>
          <p>When the JS engine sees a setTimeout or an event listener, it stores the callback function in the Web API environment.</p>

          <h3>Example Flow:</h3>
          <ul>
            <li>console.log("Start")</li>
            <li>document.getElementById("btn").addEventListener("click", function cb() { console.log("Callback"); });</li>
            <li>console.log("End")</li>
          </ul>

          <h3>Execution Steps:</h3>
          <ul>
            <li>JS executes console.log("Start") first.</li>
            <li>The callback function (cb) is registered and stored in the Web API environment.</li>
            <li>JS executes console.log("End").</li>
            <li>When a user clicks the button: The function is taken from the Web API environment and moved to the Callback Queue.</li>
          </ul>

          <h2>The Role of the Event Loop</h2>
          <p>The Event Loop‚Äôs job is to continuously monitor both the Callback Queue and the Call Stack.</p>
          <ul>
            <li>It checks if the Call Stack is empty.</li>
            <li>If the stack is empty and there is a function ready in the Callback Queue, it "pushes" that function into the Call Stack for execution.</li>
          </ul>

          <h2>Why do we need a Callback Queue?</h2>
          <p>If a user clicks a button 100 times, those 100 callback functions need to be stored somewhere so they can be executed one by one in the order they occurred.</p>
          
          <blockquote>
            <p><strong>Important Note:</strong> The Event Loop will only take tasks from the Callback Queue or Microtask Queue once the whole global code execution is finished (the stack is empty). If there are too many tasks, it might take time to get to them.</p>
          </blockquote>

          <h2>The Microtask Queue (Priority)</h2>
          <p>The fetch() function works a little differently. Because fetching data is considered very important, it is given higher priority than other callback functions.</p>
          <ul>
            <li>Instead of being stored in the Callback Queue, fetch callbacks (and Promises) are stored in the Microtask Queue.</li>
            <li>The Event Loop gives preference and priority to the Microtask Queue.</li>
            <li>The Rule: Once the Call Stack is empty, the Event Loop checks the Microtask Queue first. Only after all tasks in the Microtask Queue are completed will it move on to the tasks in the Callback Queue.</li>
          </ul>

          <h3>What goes where?</h3>
          <ul>
            <li>Microtask Queue: All Promises and Mutation Observers.</li>
            <li>Callback Queue (Task Queue): Everything else, such as setTimeout(), setInterval(), and DOM events (clicks, etc.).</li>
          </ul>

        </article>
      </main>

      <footer>&copy; 2025 Rohith Kizhakekkara. All rights reserved.</footer>
    </div>
    <script src="../js/global.js"></script>
  </body>
</html>
